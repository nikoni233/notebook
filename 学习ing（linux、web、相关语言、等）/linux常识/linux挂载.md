## 【详细】linux硬盘挂载

### 一、一些基础概念

#### 1. **块设备与文件系统**

- **块设备（Block Devices）**：磁盘、硬盘分区等存储设备在Linux系统中被视为块设备。命令 `lsblk` 用来列出所有块设备（硬盘、U盘等）的结构，显示每个设备的大小、挂载点等信息。
- **文件系统**：文件系统决定了如何在磁盘上存储和管理文件。常见的文件系统类型有 `ext4` 和 `xfs`。Linux通常需要在设备上创建文件系统后才能使用。

#### 2. **物理卷（PV）、卷组（VG）和逻辑卷（LV）**

- LVM（逻辑卷管理，Logical Volume Manager）

	：是一种灵活的磁盘管理工具。LVM允许你动态调整存储空间。与传统的分区管理相比，LVM可以跨多个磁盘扩展存储，并允许在线调整存储大小。

	- **物理卷（PV）**：LVM的基础，由实际的物理硬盘或分区组成。通过 `pvcreate` 命令将一个物理设备（如 `/dev/sdb`）转换为LVM可以管理的物理卷。
	- **卷组（VG）**：由一个或多个物理卷组成。卷组是逻辑卷的基础。使用 `vgcreate` 创建卷组。
	- **逻辑卷（LV）**：类似于分区，但具有更大的灵活性。你可以创建、调整大小或删除逻辑卷。通过 `lvcreate` 创建一个逻辑卷。

#### 3. **格式化与挂载**

- **格式化（Format）**：当你新建一个逻辑卷或物理设备时，必须为其创建一个文件系统。命令 `mkfs` 用于格式化设备（创建文件系统）。在这个例子中，您使用了 `mkfs -t xfs` 来格式化设备为 XFS 文件系统。
- **挂载（Mount）**：在Linux中，硬盘和分区不会自动挂载到文件系统中，必须通过 `mount` 命令将它们挂载到一个目录（如 `/data`），挂载后该目录就可以像普通文件夹一样使用。
- **自动挂载（fstab）**：为了避免每次系统重启后手动挂载，你可以将挂载信息写入 `/etc/fstab` 文件，系统会在启动时自动挂载。

#### 4. **目录管理与权限**

- **目录管理**：命令 `mkdir` 用来创建新目录（文件夹）。例如，您通过 `mkdir /data` 创建了一个挂载点目录。
- **查看权限**：使用 `ls -ld` 命令可以查看某个目录的详细信息，包括权限、所有者等。

#### 5. **文件系统使用情况**

- **df -Th**：列出当前系统中的挂载点及其对应的文件系统类型和使用情况。它让你能够看到系统中每个分区的磁盘使用情况。

#### 6. **持久化挂载**

- **/etc/fstab**：这是Linux中的一个配置文件，它定义了文件系统如何在启动时挂载。通过 `echo` 命令把挂载信息写入 `/etc/fstab` 文件，确保系统在每次启动时自动挂载相应的分区或逻辑卷。



### 二、“卷”是什么？物理卷(PV)、卷组(VG)、和逻辑卷(LV)

#### 1. **传统的磁盘管理方式**

在传统的磁盘管理方式中，硬盘通常是分成几个部分（称为**分区**）。每个分区可以用来存储不同的操作系统或者数据。分区是把硬盘的物理空间分成多个独立的部分。

#### 2. **逻辑卷管理（LVM）介绍**

LVM 是一种更灵活的磁盘管理方式，可以让你更轻松地管理磁盘空间。传统的分区管理方式不容易调整空间（比如当一个分区满了，很难增加空间），而 LVM 可以让你在多个硬盘之间动态调整存储空间。

LVM 分为三个重要概念：**物理卷（PV）**、**卷组（VG）** 和 **逻辑卷（LV）**。

#### 3. **具体解释“卷”相关的概念**

- **物理卷（PV，Physical Volume）**：可以理解为硬盘或硬盘的一部分，它是最基础的存储单位。你可以把一个硬盘或者一个分区转换为物理卷。物理卷相当于LVM系统中的“砖头”，它提供了实际的存储空间。
	- 在你的操作中，使用 `pvcreate /dev/sdb` 是将 `/dev/sdb`（新加的硬盘）转换为一个物理卷。
- **卷组（VG，Volume Group）**：卷组是由多个物理卷组成的。可以把卷组看成一个大容器，它把多个物理卷的空间聚合在一起，形成一个更大的“池子”，这就是 LVM 提供的灵活性所在。卷组可以跨多个硬盘创建，存储空间不再受单个硬盘的限制。
	- 使用 `vgcreate vg01 /dev/sdb` 是把物理卷 `/dev/sdb` 加入到卷组 `vg01` 中。
- **逻辑卷（LV，Logical Volume）**：逻辑卷是你真正使用的存储空间，就像传统的分区一样。LVM允许你从卷组中创建多个逻辑卷，每个逻辑卷的大小可以随时调整。这就像你从一个大容器里“分配”一部分出来用作实际的存储空间。逻辑卷可以看成是可以动态调整大小的“虚拟分区”。
	- 使用 `lvcreate -l 12799 -n lv01 vg01` 是从卷组 `vg01` 中创建了一个名为 `lv01` 的逻辑卷。

#### 4. **比喻理解**

- **物理卷（PV）**：假设你有几块硬盘，它们是物理存在的硬件，像是建筑工地上的砖头。
- **卷组（VG）**：你把这些砖头放到一个大的箱子里，这个箱子就是卷组，它可以装很多砖。
- **逻辑卷（LV）**：你从这个大箱子里取出一部分砖头来建造房子，这就是逻辑卷。你可以随时把一些砖头放回箱子，或者从箱子里拿出更多砖头来扩展房子。

#### 5. **LVM 主要用途**

LVM 让你在硬盘空间的管理上更灵活，主要有以下优势：

- **动态扩展存储空间**：可以很方便地给逻辑卷增加空间，而不需要重新分区或格式化。
- **跨多个硬盘创建大空间**：可以通过卷组将多个硬盘组合在一起，形成一个大空间。

#### 小结

1. **物理卷（PV）**：硬盘或分区，提供实际的存储空间。
2. **卷组（VG）**：将多个物理卷组合在一起，提供更大的存储池。
3. **逻辑卷（LV）**：从卷组中分配出来的存储空间，相当于一个动态调整大小的分区。

### 三、示例，命令挂载详解

原代码命令：
```bash
lsblk -ip
mkdir /data
ls -ld /data
pvcreate /dev/sdb
pvs
vgcreate vg01 /dev/sdb
vgs
vgdisplay vg01
lvcreate -l 12799 -n lv01 vg01
lvs

lsblk -ip
mkfs -t xfs /dev/mapper/vg01-lv01

lsblk -ip
mount /dev/mapper/vg01-lv01 /data
df -Th

echo "/dev/mapper/vg01-lv01 /data xfs default 0 0" >> /etc/fstab
```

解读：

1. **查看磁盘信息**：

	```bash
	lsblk -ip
	```

	列出系统中所有的块设备（硬盘、分区等），你可以看到新加的硬盘 `/dev/sdb` 是否被系统识别，以及它的大小、类型等信息。

2. **创建挂载目录**：

	```bash
	mkdir /data
	```

	在 `/` 根目录下创建一个名为 `/data` 的目录，这个目录将会成为你之后的挂载点，用来挂载新的逻辑卷。

3. **检查目录权限**：

	```bash
	ls -ld /data
	```

	查看 `/data` 目录是否创建成功，以及对应的权限、所有者等详细信息。

4. **物理卷创建**：
	**物理卷**（PV）是LVM中的最基础单元，将硬盘或分区转换为物理卷后，LVM可以管理它。

	```bash
	pvcreate /dev/sdb
	```

	将 `/dev/sdb` 创建为物理卷 (PV)。

	**查看物理卷信息**：

	```bash
	pvs
	```

	列出系统中所有物理卷 (PV)，确认 `/dev/sdb` 是否成功创建为物理卷。

5. **创建卷组**：
	**卷组**（VG）是LVM中的中间层，它将多个物理卷组合在一起，形成一个更大的存储池。

	```bash
	vgcreate vg01 /dev/sdb
	```


	创建一个名为 `vg01` 的卷组，并将物理卷 `/dev/sdb` 添加到这个卷组中。
	
	查看卷组信息：
	
	```bash
	vgs
	```


	列出系统中的所有卷组。确认 `vg01` 卷组是否成功创建，并查看其包含的物理卷和大小信息。
	
	显示卷组详细信息：
	
	```bash
	vgdisplay vg01
	```
	
	详细显示卷组 `vg01` 的信息，包括卷组的总大小、可用空间等详细信息。

6. **创建逻辑卷**：
	**逻辑卷**（LV）相当于LVM中的“动态分区”，你可以随时调整它的大小。

	```bash
	lvcreate -l 12799 -n lv01 vg01
	```

	从卷组 `vg01` 中创建一个名为 `lv01` 的逻辑卷，并分配 12799 个逻辑单元（每个逻辑单元大约为4MB）。

	查看逻辑卷信息：

	```bash
	lvs
	```


	列出系统中的所有逻辑卷(LV)，确认 `lv01` 是否成功创建。

7. **再次查看磁盘信息**：

	```bash
	lsblk -ip
	```

	再次查看系统中的块设备，确认新创建的逻辑卷。你会看到新的逻辑卷 `/dev/mapper/vg01-lv01` 出现，表示逻辑卷已经成功创建。

8. **格式化逻辑卷**：

	```bash
	mkfs -t xfs /dev/mapper/vg01-lv01
	```

	将逻辑卷 `vg01-lv01` 格式化为XFS文件系统，XFS是CentOS默认支持的高性能文件系统之一。

9. **挂载逻辑卷**：
	**挂载**是将设备（逻辑卷）与目录绑定，挂载后，你可以通过 `/data` 目录访问逻辑卷的空间。

	```bash
	mount /dev/mapper/vg01-lv01 /data
	```

	将逻辑卷挂载到 `/data` 目录。

10. **查看挂载情况**：

	```bash
	df -Th
	```

	列出每个挂载的文件系统的使用情况和文件系统类型，确保新的逻辑卷已正确挂载。你会看到 `/data` 目录下的逻辑卷已经成功挂载，并且它使用了XFS文件系统。

11. **设置自动挂载**：

	```bash
	echo "/dev/mapper/vg01-lv01 /data xfs default 0 0" >> /etc/fstab
	```

	将挂载信息添加到 `/etc/fstab` 文件中，确保系统重启后自动挂载。



### 四、挂载的详细解释，什么是挂载？

> 内容转自：
> [Linux学习笔记（二）：什么是挂载？mount的用处在哪？_linux挂载的作用-CSDN博客](https://blog.csdn.net/qq_39521554/article/details/79501714)
> [什么是挂载，Linux挂载如何实现详解 - 苍青浪 - 博客园 (cnblogs.com)](https://www.cnblogs.com/cangqinglang/p/12170828.html)



关于挂载的作用一直不是很清楚，今天在阅读教材时看见了mount这个命令，发现它的用处很隐晦但非常强大。奈何教材说的不明朗，因此在网上整合了一些优秀的解释，看完之后豁然开朗。

1.提一句Windows下，mount挂载，就是给磁盘分区提供一个盘符（C,D,E,...）。比如插入U盘后系统自动分配给了它I:盘符其实就是挂载，退优盘的时候进行安全弹出，其实就是卸载unmount。

2.Linux下，不像Windows可以有C,D,E,多个目录，Linux只有一个根目录/。在装系统时，我们分配给linux的所有区都在/下的某个位置，比如/home等等。

3.提问者插入了新硬盘，分了新磁盘区sdb1。它现在还不属于/。

4.我们虽然可以在一些图形桌面系统里找到他的位置，浏览管理里面的文件，但在命令行却不知怎么访问它的目录，比如无法使用cd或者ls。也无法在编程时指定一个目录对它操作。

5.这时提问者使用了 mount /dev/sdb1 ~/Share/ ，把新硬盘的区sdb1挂载到工作目录的~/Share/文件夹下，之后访问这个~/Share/文件夹就相当于访问这个硬盘2的sdb1分区了。对/Share/的任何操作，都相当于对sdb1里文件的操作。

6.所以Linux下，mount挂载的作用，就是将一个设备（通常是存储设备）挂接到一个已存在的目录上。访问这个目录就是访问该存储设备。

7.linux操作系统将所有的设备都看作文件，它将整个计算机的资源都整合成一个大的文件目录。我们要访问存储设备中的文件，必须将文件所在的分区挂载到一个已存在的目录上，然后通过访问这个目录来访问存储设备。挂载就是把设备放在一个目录下，让系统知道怎么管理这个设备里的文件，了解这个存储设备的可读写特性之类的过程。

8.我们不是有/dev/sdb1 吗，直接对它操作不就行了？这不是它的目录吗？

9.这不是它的目录。虽然/dev是个目录，但/dev/sdb1不是目录。可以发现ls/dev/sdb1无法执行。/dev/sdb1，是一个类似指针的东西，指向这个分区的原始数据块。mount前，系统并不知道这个数据块哪部分数据代表文件，如何对它们操作。

10.插入CD，系统其实自动执行了 mount /dev/cdrom /media/cdrom。所以可以直接在/media/cdrom中对CD中的内容进行管理。



---

### 五、查看某个目录的挂载路径

要查看某个目录的硬盘挂载情况，可以使用`df`、`mount`、`findmnt`等指令来查看：

**1. 使用 `df` 命令**

`df` 命令用于报告文件系统的磁盘空间使用情况，您可以指定某个目录来查看其挂载情况。

```shell
df -h /path/to/directory
```

- `-h` 选项使输出更具可读性（以人类可读的格式显示）。
- `/path/to/directory` 是你要检查的目录路径。

**2. 使用 `mount` 命令**

`mount` 命令显示当前挂载的所有文件系统。

```shell
mount | grep '/path/to/directory'
```

**3. 使用 `findmnt` 命令**

`findmnt` 命令用于查找挂载的文件系统。

```shell
findmnt /path/to/directory
```

**示例：**

```shell
df -h /home		#这将显示`/home`目录所在的文件系统的挂载情况，包括总空间、已用空间、可用空间等信息。
mount | grep '/home'	#这将显示包含`/home`目录的挂载信息。
findmnt /home	#这将输出关于`/home`目录的挂载信息，包括设备、挂载点、文件系统类型等。
```

